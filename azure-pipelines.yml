variables:
- group: GitHub Token
- group: VS Marketplace Token
trigger:
  branches:
    include:
    - master
    - release/v*
    - refs/tags/v*
pr:
  branches:
    include:
    - master
    - release/v*
pool:
  vmImage: 'ubuntu-16.04'
jobs:
- job: Build
  steps:
  - checkout: self
    persistCredentials: true
    clean: true
  - powershell: 'Get-ChildItem Env:'
    displayName: 'Get-ChildItem Env:'
  - task: PowerShell@2
    displayName: 'NPM Build'
    inputs:
      targetType: 'inline'
      script: 'npm run prod:full'
    env:
      GITHUBTOKEN: $(GitHubToken)
      VSMARKETPLACETOKEN: $(VsMarketplaceToken)
- job: Release
  dependsOn: Build
  condition: and(succeeded(), eq(variables['Release'], 'true'))
  - task: GitHubRelease@0
    inputs:
      gitHubConnection: 
      repositoryName: '$(Build.Repository.Name)'
      action: 'create'
      target: '$(Build.SourceVersion)'
      tagSource: 'auto'
      title: 'Azure Bake ADO Tools Extension'
      assets: '$(Build.ArtifactStagingDirectory)/*'
      assetUploadMode: 'delete'
    